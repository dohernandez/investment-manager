{#
    entities => Entity[] -> Entity list. Entity should implement getId() and __toString() functions
    new_url => url to create a new entity
    entity_name => entity name
    fields => {
                'render': {
                    base: <value>, default(text) -> How to render the field. Render type [text, currency, date, slice]
                    option: <value>

                        1. base 'text' option should not be defined.
                        2. base 'truncate' option value is the slice until the truncate value.
                        3. base 'date' option value is the format date.
                        4. base 'currency' option value is the format currency.
                },
                'name': <value>, # required -> Column name
                'label': <value>, -> Column name label. When label is not defined then name is used instead.
                'col_with': <value> -> Collumn with
            }

     'buttons': [
           {
               'type': '<value>', default('info') -> buton type.
               'jsClass': '<value>', default('js-entity-view') -> buton type.
               'icon': '<value>', default('fas fa-eye') -> buton icon.
           },
       ]
    form => form object,
#}

{% extends 'base.html.twig' %}
{% import 'Components/Macros/crud-manage-render.html.twig' as render %}

{% block stylesheets %}
    {{ parent() }}

    <link rel="stylesheet" href="{{ asset('build/vendors.css') }}">
    <link rel="stylesheet" href="{{ asset('build/crud_manager.css') }}">
{%  endblock %}

{% block page_content %}
    <div class="row js-crud-manage-row-box">
        <div class="col-md-12">
            <div class="box">
                <div class="box-header with-border js-manage-header">
                    <div class="col-md-12 js-manage-header-create-button-container">
                        <!-- create button table manager template -->
                    </div>
                    <div class="col-md-12" style="margin-top: 20px;">
                        <div class="col-md-4 js-manage-header-per-page-container" style="padding-left: 0px;">

                        </div>
                        <div class="col-md-4 pull-right js-manage-header-search-container" style="padding-right: 0px;">
                            <!-- create search table manager template -->
                        </div>
                    </div>
                </div>
                <div class="box-body table-responsive no-padding">
                    <table id="{{ entity_name|trans|lower|trim(' ') }}s" class="table table-bordered table-striped js-manager-table">
                        <thead>
                        <tr>
                            <th width="60" class="text-center" scope="col">#</th>
                            {% for field in fields %}
                                <th {% if field.col_with is defined %} width="{{ field.col_with }}" {% endif %} scope="col"
                                        {% if field.class is defined %} class="{{ field.class }}" {% endif %}>
                                    {% if field.label is not defined %}{{ field.name|trans|upper }}{% else %}{{ field.label|trans|upper }}{% endif %}
                                </th>
                            {% endfor %}
                            <th class="js-manage-buttons" scope="col"></th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                        <tfoot>
                        <tr>
                            <th class="text-center" scope="col">#</th>
                            {% for field in fields %}
                                <th {% if field.class is defined %} class="{{ field.class }}" {% endif %}  scope="col">
                                    {% if field.label is not defined %}{{ field.name|trans|upper }}{% else %}{{ field.label|trans|upper }}{% endif %}
                                </th>
                            {% endfor %}
                            <th scope="col"></th>
                        </tr>
                        </tfoot>
                    </table>
                </div>
                <div class="box-footer with-border js-manage-footer">
                    <div class="col-md-12">
                        <div class="pull-left col-sm-6">
                            <span class="js-manage-pagination-info" id="{{ entity_name|trans|lower|trim(' ') }}s-pagination-info" role="status" aria-live="polite"
                               data-text="{{ 'Showing :from to :to of :of'|trans }} {{ entity_name|trans|lower|trim(' ') }}s"></span>
                        </div>
                        <div class="pull-right col-sm-6">
                            <ul id="{{ entity_name|trans|lower|trim(' ') }}s-pagination" class="pagination-sm pagination js-manage-pagination pull-right"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <!-- create button table manager template -->
    <script type="text/template" id="js-manager-create-button-template">
        <button class="js-entity-create btn btn-success pull-right">
            <i class="fa-plus-circle fa" aria-hidden="true"></i> {{ 'Create new'|trans }} {{ entity_name|trans|lower }}</button>
    </script>

    <!-- create search table manager template -->
    <script type="text/template" id="js-manager-search-template">
        <label class="pull-right">Search:
            <div class="btn-group">
                <input type="search" class="form-control js-manage-search" placeholder="Search" aria-controls="search"
                       style="width: 248px; display: inline-block;">
                <span class="glyphicon glyphicon-remove-circle js-manage-search-clear"
                      style="display: none;"></span>
            </div>
        </label>
    </script>

    <!-- create search table manager template -->
    <script type="text/template" id="js-manager-show-per-page-template">
        <label>{{ 'Show'|trans }}
            <select id="show-{{ entity_name|trans|lower|trim(' ') }}s-per-page" name="manage-per-page" aria-controls="per page"
                    class="form-control input-sm js-manage-show-per-page"
                    style="width: 75px; display: inline-block;">
                <option value="10">10</option>
                <option value="25">25</option>
                <option value="50">50</option>
                <option value="100">100</option>
            </select>
            entries</label>
    </script>

    <!-- row table manager template -->
    <script type="text/template" id="js-manager-row-template">
        <tr data-id="<%= id %>" data-i="<%= index %>">
            <th style="vertical-align: middle;" scope="row" class="text-center js-manager-row-index"><%= index %></th>
            {% for field in fields %}
                <td style="vertical-align: middle;" {% if field.class is defined %} class="{{ field.class }}" {% endif %}>
                    {{ render.field(field.name, field) }}
                </td>
            {% endfor %}
            <td style="text-align: center;">
                <% if (viewButton) { %>
                <button type="button" data-backdrop="static" data-keyboard="false" class="js-entity-edit btn btn-default btn-sm pull-left"
                        style="margin-left: 3px">
                    <i class="fas fa-eye" aria-hidden="true"></i>
                </button>
                <% } %>
                {% if buttons is defined %}
                    {% for button in buttons %}
                        {#
                            'buttons': [
                               {
                                   'type': '<value>', default('info') -> buton type.
                                   'jsClass': '<value>', default('js-entity-view') -> buton type.
                                   'icon': '<value>', default('fas fa-eye') -> buton icon.
                               },
                           ]
                        #}
                        <button class="{{ button.jsClass|default('js-entity-view') }} btn btn-{{ button.type|default('info') }} btn-sm pull-left"
                                style="margin-left: 3px">
                            <i class="{{ button.icon|default('fas fa-eye') }}" aria-hidden="true"></i>
                        </button>
                    {% endfor %}
                {% endif %}
                <% if (editButton) { %>
                <button type="button" data-backdrop="static" data-keyboard="false" class="js-entity-edit btn btn-primary btn-sm pull-left"
                        style="margin-left: 3px">
                    <i class="fa fa-pencil-alt" aria-hidden="true"></i>
                </button>
                <% } %>
                <% if (deleteButton) { %>
                <button type="button" data-backdrop="static" data-keyboard="false" class="js-entity-delete btn btn-danger btn-sm"
                        data-id="<%= id %>" data-title="<%= title %>" style="margin-left: 3px">
                    <i class="fa-trash-alt fa" aria-hidden="true"></i>
                </button>
                <% } %>
            </td>
        </tr>
    </script>

    <!--
        This two script exposes a global variable called Routing.
        You can use that Routing variable to generate links in the same way that we use the
        path function in Twig templates: just pass it the route name and parameters.
    -->
    <script src="{{ asset('bundles/fosjsrouting/js/router.min.js') }}"></script>
    <script src="{{ path('fos_js_routing_js', { callback: 'fos.Router.setData' }) }}"></script>

    <script src="{{ asset('build/vendors.js') }}"></script>
    <script src="{{ asset('build/crud_manager.js') }}"></script>

    <!-- form table manager template -->
    <script type="text/template" id="js-manager-form-template">
        {% set _form_theme = form_theme|default('Components/Form/horizontal-theme-form.html.twig') %}
        {% form_theme form _form_theme %}

        {{ form_start(form, {'attr': {'id': 'entity-form', 'class': 'form-horizontal js-entity-create-from' }}) }}
        <div class="box-body">
            {{ form_widget(form) }}
        </div>
        {{ form_end(form) }}
    </script>

    <script>
        $(document).ready(function(){

            // Create page instance
            let contentWrapper = $('.js-crud-manage-row-box').closest('section');

            // Set up swal confirm options
            let swalConfirmOptions = {
                customClass: {
                    confirmButton: 'btn btn-danger',
                    cancelButton: 'btn btn-default',
                    title: 'swal2-confirm-title',
                    content: 'swal2-confirm-content',
                    actions: 'swal2-confirm-actions',
                },
                buttonsStyling: false,
                type: 'warning',
                width: 500,
                showCancelButton: true,
                showLoaderOnConfirm: true,
                allowOutsideClick: false,
                showCloseButton: true,
                position: 'top',
                confirmButtonText: '{{ 'Delete'|trans }}',
                titleText: '{{ 'Delete'|trans }} {{ entity_name|trans|title }}',
                text: '{{ 'Do you want to delete the'|trans }} {{ entity_name|trans|title|lower }} {0}?',
            };

            // Set up swal confirm options
            let swalFormOptions = {
                customClass: {
                    confirmButton: 'btn btn-danger',
                    cancelButton: 'btn btn-default',
                    title: 'swal2-form-title',
                    content: 'swal2-form-content',
                    actions: 'swal2-form-actions',
                },
                buttonsStyling: false,
                width: 600,
                showCancelButton: true,
                showLoaderOnConfirm: true,
                reverseButtons: true,
                allowEscapeKey: false,
                allowOutsideClick: false,
                showCloseButton: true,
                position: 'top'
            };

            // Set up toast options, for showing the operation final status at the end.
            let toastOptions = {
                toast: true,
                position: 'top',
                showConfirmButton: false,
                timer: 3000,
                customClass: {
                    title: 'swal2-toast-title',
                },
                titleText: '{{ entity_name|trans|title }} {{ 'was {0} successfully.'|trans }}'
            };

            // Create CRUDManage instance @see public/assets/js/CRUDManage.js
            window.crudManager = new CRUDManage({
                entityType: '{{ entity_name|snake }}',
                wrapper: contentWrapper,
                swalFormOptions: swalFormOptions,
                swalConfirmOptions: swalConfirmOptions,
                toastOptions: toastOptions,
                pagination: true,
            });
        });
    </script>
{% endblock %}

