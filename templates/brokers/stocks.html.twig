{% extends 'base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}

    {% include 'Components/ui/crud-manage-css.html.twig' %}
{%  endblock %}

{% block page_content %}
    {% include 'Components/ui/crud-manage-table.html.twig' %}
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    {% include 'Components/ui/crud-manage-scripts.html.twig' %}
    <script>
        $(document).ready(function() {
            let swalFormOptionsText = {
                create: {
                    confirmButtonText: '{{ 'Add'|trans }}',
                    titleText: '{{ 'Add new'|trans }} {{ entity_name|trans|title }}',
                    toastTitleText: '{{ entity_name|trans|title }} {{ 'was added successfully.'|trans }}'
                },
                delete: {
                    toastTitleText: '{{ entity_name|trans|title }} {{ 'was removed successfully.'|trans }}'
                }
            };

            // Create page instance
            let $crudManagerRowBox = $('.{{ js_crud_manage_class|default('js-crud-manage-row-box') }}');

            let contentWrapper = $crudManagerRowBox.closest('section');
            let entityType = $crudManagerRowBox.data('entity-type');

            // Create CRUDManage instance @see public/assets/js/CRUDManage.js
            let crudManager = new CRUDManage({
                entityType: entityType,
                wrapper: contentWrapper,
                swalFormOptions: window.swalFormOptions,
                swalConfirmOptions: window.swalConfirmOptions,
                toastOptions: window.toastOptions,
                pagination: true,
            });

            // const form = new BrokerForm(swalFormOptionsText);

            // crudManager.withForm(form);
            // add button create
            crudManager.withCreateButton();
            // add button delete
            crudManager.withDeleteButton();

            // add button extra
            // Delegate selector for edit stock dividend
            $('.js-crud-manage-row-box').closest('section').on(
                'click',
                '.js-entity-edit-dividend-yield',
                function (e) {
                    e.preventDefault();

                    const $row = $(e.currentTarget).closest('tr');
                    const id = $row.data('id');

                    window.location = Routing.generate('stock_dividend_index', {'_id': id})
                }
            );
            crudManager.withExtraButton();

            crudManager.setRouteGenerating((entityType, endpoint, id = null) => {
                let route = '';
                let param = {
                    'id': {{ broker.id }}
                };

                switch (endpoint) {
                    case 'list':
                        route = Routing.generate(entityType + '_list', param);

                        break;
                    case 'delete':
                        route = Routing.generate(entityType + '_delete', param);

                        break;
                    default:
                        throw 'Endpoint ' + endpoint + ' not supported';
                }

                return route
            });

            crudManager.render();
        });
    </script>

{% endblock %}
