{% extends 'base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}

    {% include 'Components/ui/crud-manage-css.html.twig' %}

    <link rel="stylesheet" href="{{ asset('build/broker_form.css') }}">
{%  endblock %}

{% block page_content %}
    {% include 'Components/ui/crud-manage-table.html.twig' %}
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    {% include 'Components/ui/crud-manage-scripts.html.twig' %}
    {% include 'Components/ui/crud-manage-table-scripts.html.twig' %}

    <script src="{{ asset('build/broker_form.js') }}"></script>

    <script>
        $(document).ready(function() {
            let swalFormOptionsText = {
                create: {
                    confirmButtonText: '{{ 'Create'|trans }}',
                    titleText: '{{ 'Create new'|trans }} {{ entity_name|trans|title }}',
                    toastTitleText: '{{ entity_name|trans|title }} {{ 'was created successfully.'|trans }}'
                },
                update: {
                    confirmButtonText: '{{ 'Update'|trans }}',
                    titleText: '{{ 'Update'|trans }} {{ entity_name|trans|title }}',
                    toastTitleText: '{{ entity_name|trans|title }} {{ 'was updated successfully.'|trans }}'
                },
                delete: {
                    toastTitleText: '{{ entity_name|trans|title }} {{ 'was deleted successfully.'|trans }}'
                }
            };

            // Create page instance
            let $crudManagerRowBox = $('.{{ js_crud_manage_class|default('js-crud-manage-row-box') }}');

            let contentWrapper = $crudManagerRowBox.closest('section');
            let entityType = $crudManagerRowBox.data('entity-type');

            // Create CRUDManage instance @see public/assets/js/CRUDManage.js
            let crudManager = new CRUDManage({
                entityType: entityType,
                wrapper: contentWrapper,
                swalFormOptions: window.swalFormOptions,
                swalConfirmOptions: window.swalConfirmOptions,
                toastOptions: window.toastOptions,
                pagination: true,
                selectors: {
                    createButtonTemplate: '#js-manager-{{ entity_name|lower|replace({' ': '_'}) }}-create-button-template',
                    searchTemplate: '#js-manager-{{ entity_name|lower|replace({' ': '_'}) }}-search-template',
                    showPerPageTemplate: '#js-manager-{{ entity_name|lower|replace({' ': '_'}) }}-show-per-page-template',
                    rowTemplate: '#js-manager-{{ entity_name|lower|replace({' ': '_'}) }}-row-template',
                },
            });

            const form = new BrokerForm(
                swalFormOptionsText,
                '#js-manager-{{ entity_name|lower|replace({' ': '_'}) }}-form-template',
            );

            crudManager.withForm(form);
            // add button create
            crudManager.withCreateButton();
            // add button edit
            crudManager.withEditButton();
            // add button delete
            crudManager.withDeleteButton();

            // add button extra
            // Delegate selector for edit stock dividend
            $('.js-crud-manage-row-box').closest('section').on(
                'click',
                '.js-entity-edit-broker-stocks',
                function (e) {
                    e.preventDefault();

                    const $row = $(e.currentTarget).closest('tr');
                    const id = $row.data('id');

                    window.location = Routing.generate('broker_stock_index', {id})
                }
            );
            // 2 is the extra width require to adjust the button col
            crudManager.withExtraButton(2);

            crudManager.render();
        });
    </script>

{% endblock %}
